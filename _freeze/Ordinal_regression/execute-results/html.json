{
  "hash": "fffa3e2091515f03f42c2a963dcd98f6",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Ordinal regression\"\nauthor: Vladimir Buskin\nformat:\n  html:\n    self-contained: false\n    logo: logo.png\n    footer: \"Regression\"\n    theme: Reference\n    toc: true\n    number-sections: true\n    slide-number: true\n    incremental: false\n    slide-level: 4\n    scrollable: true\neditor: visual\nbibliography: R.bib\n---\n\n\n## Suggested reading\n\n> @powersStatisticalMethodsCategorical2008: Chapter 7;\n> @baguleySeriousStatsGuide2012: Chapter 17.4.5\n\n## Introduction\n\nIn her recent contribution, @glassEnglishVerbsCan2021 examines possible\nreasons why certain transitive verbs have a stronger affinity towards\nobject omission compared to others, placing special emphasis on the\nroutinisation of the actions denoted by the verbs. Specifically, she\nanalyses **how high/low-routine contexts affect the acceptability of\nobject omission** for transitive verbs from different frequency bins.\n\nWe will replicate her findings using her survey data\n`Glass_2021_survey_processed.csv`[^ordinal_regression-1]:\n\n[^ordinal_regression-1]: The original dataset can be retrieved from\n    Lelia Glass's OSF repository: <https://osf.io/t6zw5> \\[Last\n    accessed: 27th September, 2024\\].\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load libraries\nlibrary(tidyverse)\nlibrary(ordinal)\n\n# Load data\nsurvey <- read.csv(\"Glass_2021_survey_processed.csv\")\n\n# Inspect dataset\nstr(survey)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n'data.frame':\t784 obs. of  5 variables:\n $ rating       : int  3 4 3 3 2 4 3 2 3 2 ...\n $ freq         : chr  \"hi\" \"lo\" \"lo\" \"hi\" ...\n $ verb         : chr  \"pick\" \"catch\" \"throw\" \"break\" ...\n $ ParticipantID: chr  \"Participant1\" \"Participant1\" \"Participant1\" \"Participant1\" ...\n $ routine      : chr  \"hi\" \"lo\" \"lo\" \"lo\" ...\n```\n\n\n:::\n\n```{.r .cell-code}\nhead(survey)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  rating freq   verb ParticipantID routine\n1      3   hi   pick  Participant1      hi\n2      4   lo  catch  Participant1      lo\n3      3   lo  throw  Participant1      lo\n4      3   hi  break  Participant1      lo\n5      2   hi  taste  Participant1      hi\n6      4   hi bottle  Participant1      hi\n```\n\n\n:::\n:::\n\n\n::: {.callout-note collapse=\"true\" title=\"Short breakdown of the variables\"}\n-   `routine`: In Glass's study, transitive verbs were randomly assigned\n    to one of the following conditions:\n\n> -   (High routine condition:) I worked at my poultry farm. Just like I\n>     always do, I butchered some chickens. Then I gathered some eggs.\n>\n> -   (Low-routine condition:) I visited a friend's job. Just because\n>     people wanted me to try it, I butchered some chickens. Then I went\n>     for a walk.\n>\n> Cf. Glass [-@glassEnglishVerbsCan2021: 66]\n\n\n::: {.cell}\n\n```{.r .cell-code}\nunique(survey$routine)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"hi\" \"lo\"\n```\n\n\n:::\n:::\n\n\n-   `rating` records the responses of participants to a follow-up\n    question regarding the acceptability of object omission. The answers\n    are recorded on a 1-5 Likert scale.\n\n> *The next time Caroline talks about butchering chickens the day\n> before, how likely do you think she is to say the following?*\n>\n> 'I butchered yesterday'\n>\n> Cf. Glass [-@glassEnglishVerbsCan2021: 66]\n\n\n::: {.cell}\n\n```{.r .cell-code}\nunique(survey$rating)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 3 4 2 5 1\n```\n\n\n:::\n:::\n\n\n-   `verb` contains the items to be rated for the conditions in\n    `routine`\n\n\n::: {.cell}\n\n```{.r .cell-code}\nunique(survey$verb)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"pick\"   \"catch\"  \"throw\"  \"break\"  \"taste\"  \"bottle\" \"sell\"   \"chop\"  \n```\n\n\n:::\n:::\n\n\n-   `frequency` relates to the frequency bins of the verbs:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nunique(survey$freq)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"hi\" \"lo\"\n```\n\n\n:::\n:::\n\n\n-   `ParticipantID` identifies each of the 98 subjects who provided\n    ratings\n:::\n\n## Modelling ordinal data\n\nAnswering the research question means assessing how the features\n`routine` and `freq` affect the variability in the acceptability\nratings. Furthermore, it is important to control for repeated\nmeasurements for `verb` and `ParticipantID`, which impose a hierarchical\nstructure on the dataset.\n\nFormally speaking, we have $p$ explanatory variables\n$X_1, X_2, ..., X_p$ for $p \\in \\{1, ..., P\\}$. The target variable\n`rating` is our target variable $Y$ with the ordered, discrete outcomes\n$y \\in \\{1, 2, 3, 4, 5\\}$.\n\nOur goal is to find a model $f$ that describes the relationship between\n$Y$ and $X_p$ as accurately as possible and minimises the error term\n$\\epsilon$:\n\n$$\nY = f(X_1, X_2, ..., X_p) + \\epsilon\n$$\n\n### Ordered logistic regression\n\nOne family of models that respects the ordered, yet categorical nature\nof $Y$ is ordered (or ordinal) logistic regression. Other terms include\n**proportional odds models**, **cumulative logit/link models** etc.\n\n::: {.callout-note collapse=\"true\" title=\"Recap: Logistic regression\"}\nLogistic regression is used to model categorical response variables with\ntwo or more levels. For instance, let's assume our $Y$ is dichotomous\nwith the following two outcomes:\n\n$$\nY =\n\\begin{cases}\n\\text{yes} \\\\\n\\text{no}\n\\end{cases}\n$$\n\nUsing the logistic function, we can estimate the probability of one\noutcome versus the other **given** the predictors $X_p$. Their\nlog-transformed odds ratio (**log odds**) is equivalent of the\nall-too-familiar linear model:\n\n$$\n\\log\\left(\\frac{P(Y = yes \\mid X_p)}{1 - P(Y = yes \\mid X_p)}\\right) = \\beta_0 + \\beta_1X_1 + ... + \\beta_pX_p.\n$$\n:::\n\nCore to this approach is the notion of **cumulative probabilities**. Let\n$J$ denote the number of ordered categories in $Y$. In Glass's case\nstudy ($J = 5$), the estimated cumulative probabilities for each ordered\noutcome would have the following form:\n\n$$\n\\begin{array}{rcl}\nP(Y \\leq 1) & = & P(Y = 1) \\\\\nP(Y \\leq 2) & = & P(Y = 1) + P(Y = 2) \\\\\nP(Y \\leq 3) & = & P(Y = 1) + P(Y = 2) + P(Y = 3) \\\\\nP(Y \\leq 4) & = & P(Y = 1) + P(Y = 2) + P(Y = 3) + P(Y = 4) \\\\\nP(Y \\leq 5) & = & P(Y = 1) + P(Y = 2) + P(Y = 3) + P(Y = 4) + P(Y = 5)\n\\end{array}\n$$ We can generalise this pattern to\n\n$$\nP(Y \\leq j) = \\hat{P_1} + ... + \\hat{P_j}\n$$\n\nWe can now update our logistic regression equation to take into account\ncumulative probabilities:\n\n$$\n\\log\\left(\\frac{P(Y \\leq j \\mid X_p)}{1 - P(Y \\leq j \\mid X_p)}\\right) = \\beta_0 + \\beta_1X_1 + ... + \\beta_pX_p \\qquad j = 1, ..., J-1\n$$\n\n### Application in R\n\n### Using `polr()` from the `MASS` library\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(MASS)\n# Convert to factor and determine ordering\nsurvey$rating <- factor(survey$rating, ordered = TRUE, levels = c(\"1\", \"2\", \"3\", \"4\", \"5\"))\n\n# Fit polr model\nsurvey.polr <- polr(rating ~ \n                      freq +\n                      routine,\n                      data = survey)\n\n# Model summary\nsummary(survey.polr)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(sjPlot)\ntab_model(survey.polr, show.se = TRUE, show.aic = TRUE, show.dev = TRUE, transform = NULL)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table style=\"border-collapse:collapse; border:none;\">\n<tr>\n<th style=\"border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm;  text-align:left; \">&nbsp;</th>\n<th colspan=\"4\" style=\"border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; \">rating</th>\n</tr>\n<tr>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  text-align:left; \">Predictors</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  \">Log-Odds</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  \">std. Error</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  \">CI</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  \">p</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">1|2</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">&#45;0.87</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.12</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">&#45;1.11&nbsp;&ndash;&nbsp;-0.63</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \"><strong>&lt;0.001</strong></td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">2|3</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.13</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.12</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">&#45;0.10&nbsp;&ndash;&nbsp;0.37</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.259</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">3|4</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">1.25</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.13</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">1.00&nbsp;&ndash;&nbsp;1.51</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \"><strong>&lt;0.001</strong></td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">4|5</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">2.89</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.20</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">2.50&nbsp;&ndash;&nbsp;3.28</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \"><strong>&lt;0.001</strong></td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">freq [lo]</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">&#45;0.01</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.13</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">&#45;0.26&nbsp;&ndash;&nbsp;0.24</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.932</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">routine [lo]</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">&#45;0.56</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.13</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">&#45;0.81&nbsp;&ndash;&nbsp;-0.30</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \"><strong>&lt;0.001</strong></td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm; border-top:1px solid;\">Observations</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;\" colspan=\"4\">784</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;\">R<sup>2</sup> Nagelkerke</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"4\">0.024</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;\">Deviance</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"4\">2246.662</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;\">AIC</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"4\">2258.662</td>\n</tr>\n\n</table>\n\n`````\n:::\n\n```{.r .cell-code}\n## Get diagnostics\nlibrary(DescTools)\nPseudoR2(survey.polr, c(\"Nagelkerke\", \"AIC\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  Nagelkerke          AIC \n   0.0244793 2258.6617419 \n```\n\n\n:::\n\n```{.r .cell-code}\n## Goodness-of-fit tests\nlibrary(generalhoslem)\nlipsitz.test(survey.polr)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tLipsitz goodness of fit test for ordinal response models\n\ndata:  formula:  rating ~ freq + routine\nLR statistic = 20.261, df = 9, p-value = 0.01637\n```\n\n\n:::\n\n```{.r .cell-code}\npulkrob.chisq(survey.polr, catvars = c(\"freq\", \"routine\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tPulkstenis-Robinson chi-squared test\n\ndata:  formula:  rating ~ freq + routine\nX-squared = 21.476, df = 9, p-value = 0.0107\n```\n\n\n:::\n\n```{.r .cell-code}\n## Test proportional odds assumption\nlibrary(brant)\nbrant(survey.polr) # p < 0.05 is a violation of the assumption\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n-------------------------------------------- \nTest for\tX2\tdf\tprobability \n-------------------------------------------- \nOmnibus\t\t14.45\t6\t0.02\nfreqlo\t\t6.5\t3\t0.09\nroutinelo\t8.14\t3\t0.04\n-------------------------------------------- \n\nH0: Parallel Regression Assumption holds\n```\n\n\n:::\n\n```{.r .cell-code}\n## Plot (best so far)\nlibrary(effects)\nlibrary(ggeffects)\n\n## Frequency effect plot\n#plot(Effect(focal.predictors = c(\"freq\"), mod = survey.polr), rug = FALSE, style = \"stacked\")\n\n## Routine effect plot\nplot(Effect(focal.predictors = c(\"routine\"), mod = survey.polr), rug = FALSE, style=\"stacked\")\n```\n\n::: {.cell-output-display}\n![](Ordinal_regression_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n\n```{.r .cell-code}\n## Interaction\n#plot(Effect(focal.predictors = c(\"routine\", \"freq\"), mod = survey.polr), rug = FALSE,\n #    style=\"stacked\")\n```\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggpubr)\nggarrange(p1, p2, ncol = 2, common.legend = TRUE, legend = \"right\")\n```\n\n::: {.cell-output-display}\n![](Ordinal_regression_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](Ordinal_regression_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n### Using `clm()` from the `ordinal` library\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Convert to factor and determine ordering\nsurvey$rating <- factor(survey$rating, ordered = TRUE, levels = c(\"1\", \"2\", \"3\", \"4\", \"5\"))\n\n# Fit cumulative link model\nclm.1 <- ordinal::clm(rating ~ \n                    freq +\n                    routine,\n                    data = survey, Hess=TRUE)\n\n# Model summary\nsummary(clm.1)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntab_model(clm.1, show.se = TRUE, show.aic = TRUE, show.dev = TRUE, transform = NULL)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table style=\"border-collapse:collapse; border:none;\">\n<tr>\n<th style=\"border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm;  text-align:left; \">&nbsp;</th>\n<th colspan=\"4\" style=\"border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; \">rating</th>\n</tr>\n<tr>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  text-align:left; \">Predictors</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  \">Log-Odds</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  \">std. Error</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  \">CI</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  \">p</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">1|2</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">&#45;0.87</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.12</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">&#45;1.11&nbsp;&ndash;&nbsp;-0.63</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \"><strong>&lt;0.001</strong></td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">2|3</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.13</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.12</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">&#45;0.10&nbsp;&ndash;&nbsp;0.37</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.259</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">3|4</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">1.25</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.13</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">1.00&nbsp;&ndash;&nbsp;1.51</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \"><strong>&lt;0.001</strong></td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">4|5</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">2.89</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.20</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">2.50&nbsp;&ndash;&nbsp;3.28</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \"><strong>&lt;0.001</strong></td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">freq [lo]</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">&#45;0.01</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.13</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">&#45;0.26&nbsp;&ndash;&nbsp;0.24</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.932</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">routine [lo]</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">&#45;0.56</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.13</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">&#45;0.81&nbsp;&ndash;&nbsp;-0.30</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \"><strong>&lt;0.001</strong></td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm; border-top:1px solid;\">Observations</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;\" colspan=\"4\">784</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;\">R<sup>2</sup> Nagelkerke</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"4\">0.024</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;\">AIC</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"4\">2258.662</td>\n</tr>\n\n</table>\n\n`````\n:::\n:::\n\n\n### Mixed-effects\n\n::: {.callout-note collapse=\"true\" title=\"Recap: Mixed-effects models\"}\nIf the data is nested according to some grouping factor with $1, ..., K$\ngroups, we can let the intercept and/or slopes vary by group. For\ninstance, recall the varying-intercept model:\n\n$$\nY = \\alpha_{k} + \\beta_1X_{1} + \\beta_2X_{2} + ... + \\epsilon \\qquad \\alpha_{j} \\sim N(\\mu_{\\alpha}, \\sigma_{\\alpha}^2).\n$$ In this case we also speak of **random effects**.\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Convert to factor and determine ordering\nsurvey$rating <- factor(survey$rating, ordered = TRUE, levels = c(\"1\", \"2\", \"3\", \"4\", \"5\"))\n\n\n# Fit mixed model with random intercepts for \"verb\" and \"ParticipantID\"\nclm.2 <- ordinal::clmm(rating ~ \n                    freq * routine +\n                    (1 | verb) +\n                    (1 | ParticipantID),\n                    data = survey, Hess=TRUE)\n\n# Model summary\nsummary(clm.2)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntab_model(clm.2, show.se = TRUE, show.aic = TRUE, show.dev = TRUE, transform = NULL)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table style=\"border-collapse:collapse; border:none;\">\n<tr>\n<th style=\"border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm;  text-align:left; \">&nbsp;</th>\n<th colspan=\"4\" style=\"border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; \">rating</th>\n</tr>\n<tr>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  text-align:left; \">Predictors</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  \">Log-Odds</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  \">std. Error</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  \">CI</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  \">p</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">1|2</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">&#45;1.36</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.40</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">&#45;2.14&nbsp;&ndash;&nbsp;-0.57</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \"><strong>0.001</strong></td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">2|3</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.21</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.40</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">&#45;0.58&nbsp;&ndash;&nbsp;0.99</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.605</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">3|4</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">1.83</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.41</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">1.04&nbsp;&ndash;&nbsp;2.63</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \"><strong>&lt;0.001</strong></td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">4|5</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">3.86</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.44</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">3.00&nbsp;&ndash;&nbsp;4.73</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \"><strong>&lt;0.001</strong></td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">freq [lo]</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">&#45;0.16</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.21</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">&#45;0.58&nbsp;&ndash;&nbsp;0.26</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.463</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">routine [lo]</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">&#45;0.75</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.21</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">&#45;1.16&nbsp;&ndash;&nbsp;-0.34</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \"><strong>&lt;0.001</strong></td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">freq [lo] × routine [lo]</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">&#45;0.14</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.30</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">&#45;0.72&nbsp;&ndash;&nbsp;0.44</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.637</td>\n</tr>\n<tr>\n<td colspan=\"5\" style=\"font-weight:bold; text-align:left; padding-top:.8em;\">Random Effects</td>\n</tr>\n\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;\">&sigma;<sup>2</sup></td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"4\">3.29</td>\n</tr>\n\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;\">&tau;<sub>00</sub> <sub>ParticipantID</sub></td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"4\">2.06</td>\n\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;\">&tau;<sub>00</sub> <sub>verb</sub></td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"4\">0.91</td>\n\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;\">ICC</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"4\">0.47</td>\n\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;\">N <sub>verb</sub></td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"4\">8</td>\n\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;\">N <sub>ParticipantID</sub></td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"4\">98</td>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm; border-top:1px solid;\">Observations</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;\" colspan=\"4\">784</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;\">Marginal R<sup>2</sup> / Conditional R<sup>2</sup></td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"4\">0.028 / 0.489</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;\">AIC</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"4\">2001.305</td>\n</tr>\n\n</table>\n\n`````\n:::\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](Ordinal_regression_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\n## Generalised additive models (GAMs)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(mgcv)\nlibrary(itsadug)\nlibrary(gratia)\n\nsurvey$ParticipantID <- as.factor(survey$ParticipantID)\nsurvey$verb <- as.factor(survey$verb)\n\ngam1 <- bam(as.numeric(rating) ~ \n              freq +\n              routine +\n              s(ParticipantID, bs = \"re\") +\n              s(verb, bs = \"re\"),\n              data = survey, \n              family = ocat(R=5)\n            )\n\nsummary(gam1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nFamily: Ordered Categorical(-1,0.51,2.09,4.06) \nLink function: identity \n\nFormula:\nas.numeric(rating) ~ freq + routine + s(ParticipantID, bs = \"re\") + \n    s(verb, bs = \"re\")\n\nParametric coefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)   0.3613     0.3880   0.931    0.352    \nfreqlo       -0.2195     0.1431  -1.534    0.125    \nroutinelo    -0.7752     0.1428  -5.430 7.79e-08 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nApproximate significance of smooth terms:\n                    edf Ref.df      F p-value    \ns(ParticipantID) 77.654     97  4.677  <2e-16 ***\ns(verb)           6.728      7 25.860  <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nDeviance explained = 27.3%\nfREML =   1631  Scale est. = 1         n = 784\n```\n\n\n:::\n\n```{.r .cell-code}\n# Extract the thresholds on the linear predictor from the model\nthresh <- gratia::theta(gam1) |>\n  tibble::as_tibble() |>\n  setNames(c(\"threshold\"))\n\nroutine_pred <- ggpredict(gam1, terms = \"routine\")\n\nroutine_pred |>\n  ggplot(aes(x = x, y = predicted)) +\n  geom_point(col = \"steelblue\") +\n  geom_errorbar(aes(ymin = conf.low, ymax = conf.high, width = 0), col = \"steelblue\") +\n  #geom_line() +\n  geom_hline(data = thresh, aes(yintercept = threshold), linetype = \"dashed\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](Ordinal_regression_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n\n```{.r .cell-code}\nverb_pred <- ggpredict(gam1, terms = \"verb\")\n\nverb_pred |>\n  ggplot(aes(x = x, y = predicted)) +\n  geom_point(col = \"steelblue\") +\n  geom_errorbar(aes(ymin = conf.low, ymax = conf.high, width = 0), col = \"steelblue\") +\n  #geom_line() +\n  geom_hline(data = thresh, aes(yintercept = threshold), linetype = \"dashed\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](Ordinal_regression_files/figure-html/unnamed-chunk-18-2.png){width=672}\n:::\n\n```{.r .cell-code}\nsubj_pred <- ggpredict(gam1, terms = \"ParticipantID\")\n\nsubj_pred |>\n  ggplot(aes(x = x, y = predicted)) +\n  geom_point(col = \"steelblue\") +\n  geom_errorbar(aes(ymin = conf.low, ymax = conf.high, width = 0), col = \"steelblue\") +\n  #geom_line() +\n  geom_hline(data = thresh, aes(yintercept = threshold), linetype = \"dashed\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](Ordinal_regression_files/figure-html/unnamed-chunk-18-3.png){width=672}\n:::\n:::\n",
    "supporting": [
      "Ordinal_regression_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}